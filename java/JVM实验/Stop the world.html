<html lang="en"><head>
    <meta charset="UTF-8">
    <title></title>
<style>#BAIDU_DSPUI_FLOWBAR,.adsbygoogle,.ad,div[class^="ad-widsget"],div[id^="div-gpt-ad-"],a[href*="@"][href*=".exe"],a[href*="/?/"][href*=".exe"],.adpushwin{display:none !important;}</style><style id="system" type="text/css">h1,h2,h3,h4,h5,h6,p,blockquote {    margin: 0;    padding: 0;}body {    font-family: "Helvetica Neue", Helvetica, "Hiragino Sans GB", Arial, sans-serif;    font-size: 13px;    line-height: 18px;    color: #737373;    margin: 10px 13px 10px 13px;}a {    color: #0069d6;}a:hover {    color: #0050a3;    text-decoration: none;}a img {    border: none;}p {    margin-bottom: 9px;}h1,h2,h3,h4,h5,h6 {    color: #404040;    line-height: 36px;}h1 {    margin-bottom: 18px;    font-size: 30px;}h2 {    font-size: 24px;}h3 {    font-size: 18px;}h4 {    font-size: 16px;}h5 {    font-size: 14px;}h6 {    font-size: 13px;}hr {    margin: 0 0 19px;    border: 0;    border-bottom: 1px solid #ccc;}blockquote {    padding: 13px 13px 21px 15px;    margin-bottom: 18px;    font-family:georgia,serif;    font-style: italic;}blockquote:before {    content:"C";    font-size:40px;    margin-left:-10px;    font-family:georgia,serif;    color:#eee;}blockquote p {    font-size: 14px;    font-weight: 300;    line-height: 18px;    margin-bottom: 0;    font-style: italic;}code, pre {    font-family: Monaco, Andale Mono, Courier New, monospace;}code {    background-color: #fee9cc;    color: rgba(0, 0, 0, 0.75);    padding: 1px 3px;    font-size: 12px;    -webkit-border-radius: 3px;    -moz-border-radius: 3px;    border-radius: 3px;}pre {    display: block;    padding: 14px;    margin: 0 0 18px;    line-height: 16px;    font-size: 11px;    border: 1px solid #d9d9d9;    white-space: pre-wrap;    word-wrap: break-word;}pre code {    background-color: #fff;    color:#737373;    font-size: 11px;    padding: 0;}@media screen and (min-width: 768px) {    body {        width: 748px;        margin:10px auto;    }}</style><style id="custom" type="text/css"></style></head>
<body><h2>Stop The World</h2>
<p>目前常用的垃圾回收器都会将应用程序挂起（保证系统在某一瞬间的一致性），然后进行垃圾回收，这就造成了应用程序的停顿，这一停顿现象被称为<code>stop the world</code>


</p>
<h2>源码</h2>
<pre><code class="lang-java">package test;

import java.util.HashMap;
import java.util.concurrent.ExecutorService;
import java.util.concurrent.Executors;
import java.util.concurrent.TimeUnit;

public class Test {

    public static void main(String[] args) throws InterruptedException {

        ExecutorService executor = Executors.newCachedThreadPool();
        executor.execute(new TimeTask());
        executor.execute(new Spend());
        executor.awaitTermination(5,TimeUnit.SECONDS);
        executor.shutdownNow();
        System.out.println("time is up");
    }
    /**
     * @author 付大石
     * 记录时间
     */
    private static class TimeTask implements Runnable {

        private static final long START = System.currentTimeMillis();

        public TimeTask() {

        }

        @Override
        public void run() {

            try {
                while(true) {
                    long time = System.currentTimeMillis()-START;
                    System.out.printf("%d.%d\n",time/1000,time%1000);
                    Thread.sleep(10);
                }
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }

    /**
     * @author 付大石
     * 消耗内存
     */
    private static class Spend implements Runnable {

        HashMap&lt;Long,byte[]&gt; map;

        public Spend() {
            this.map = new HashMap&lt;&gt;();
        }

        @Override
        public void run() {

            try {
                while(true) {
                    if(map.size()&gt;8182) {
                        map.clear();
//                        System.out.println("clean map");
                    }
                    for(int i=0;i&lt;100;i++) {
                        map.put(System.nanoTime(),new byte[512]);
                    }
                    Thread.sleep(1);
                }
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }
    }
}</code></pre>
<h2>VM arguments</h2>
<p>-XX:+PrintCommandLineFlags
-Xmx100m
-Xms100m
-XX:+UseSerialGC
-Xloggc:gc.log
-XX:+PrintGCDetails


</p>
<h2>console</h2>
<p>-XX:InitialHeapSize=104857600 -XX:MaxHeapSize=104857600 -XX:+PrintCommandLineFlags -XX:+PrintGC -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:-UseLargePagesIndividualAllocation -XX:+UseSerialGC 
0.0
0.55
0.66
0.76
0.87
0.97
0.108
0.118
0.129
0.139
0.149
0.159
0.170
0.180
0.191
0.202
0.212
0.222
0.233
0.243
0.254
0.265
0.275
0.286
0.297
0.307
0.318
0.329
0.339
0.351
0.362
0.373
0.383
0.394
0.404
0.414
0.425
0.436
0.446
0.456
0.467
0.477
0.488
0.499
0.510
0.520
0.538
0.548
0.558
0.569
0.579
0.590
0.601
0.611
0.622
0.633
0.644
0.654
0.665
0.675
0.686
0.696
0.707
0.718
0.729
0.739
0.750
0.760
0.771
0.782
0.793
0.803
0.814
0.825
0.835
0.846
0.856
0.867
0.878
0.889
0.899
0.910
0.920
0.931
0.942
0.952
0.963
0.975
0.986
0.997
1.8
1.18
1.28
1.39
1.49
1.60
1.70
1.81
1.100
1.110
1.120
1.131
1.141
1.152
1.162
1.172
1.183
1.195
1.205
1.216
1.226
1.236
1.248
1.259
1.269
1.280
1.290
1.301
1.312
1.322
1.333
1.343
1.354
1.365
1.376
1.386
1.397
1.407
1.418
1.429
1.440
1.450
1.462
1.472
1.483
1.493
1.503
1.514
1.524
1.535
1.545
1.555
1.566
1.576
1.587
1.597
1.608
1.618
1.628
1.639
1.649
1.663
1.674
1.684
1.695
1.705
1.715
1.725
1.736
1.746
1.757
1.769
1.780
1.790
1.801
1.812
1.822
1.832
1.842
1.853
1.863
1.874
1.884
1.894
1.905
1.915
1.925
1.936
1.946
1.957
1.967
1.978
1.989
1.999
2.9
2.19
2.31
2.43
2.53
2.64
2.74
2.87
2.99
2.110
2.120
2.131
2.142
2.153
2.163
2.174
2.184
2.194
2.205
2.215
2.225
2.236
2.246
2.257
2.267
2.277
2.288
2.298
2.309
2.319
2.330
2.341
2.351
2.362
2.373
2.384
2.394
2.405
2.416
2.426
2.437
2.447
2.459
2.470
2.480
2.490
2.501
2.512
2.523
2.534
2.544
2.555
2.565
2.576
2.587
2.598
2.609
2.619
2.630
2.641
2.652
2.662
2.673
2.684
2.695
2.705
2.716
2.727
2.738
2.749
2.760
2.770
2.780
2.791
2.801
2.816
2.827
2.838
2.849
2.859
2.870
2.880
2.891
2.901
2.912
2.923
2.933
2.944
2.955
2.965
2.976
2.987
2.997
3.9
3.19
3.30
3.41
3.51
3.62
3.72
3.83
3.93
3.104
3.115
3.125
3.136
3.146
3.161
3.172
3.185
3.196
3.206
3.217
3.228
3.238
3.249
3.260
3.270
3.281
3.291
3.302
3.312
3.323
3.334
3.344
3.355
3.366
3.378
3.388
3.398
3.409
3.419
3.430
3.441
3.451
3.462
3.474
3.485
3.495
3.506
3.516
3.527
3.537
3.548
3.558
3.569
3.579
3.589
3.600
3.611
3.622
3.633
3.643
3.653
3.663
3.674
3.685
3.695
3.706
3.716
3.726
3.736
3.746
3.757
3.768
3.779
3.789
3.799
3.810
3.820
3.831
3.841
3.852
3.862
3.873
3.883
3.895
3.905
3.916
3.926
3.938
3.949
3.959
3.970
3.980
3.990
4.1
4.11
4.22
4.32
4.42
4.53
4.63
4.73
4.84
4.94
4.104
4.115
4.125
4.135
4.146
4.157
4.167
4.178
4.189
4.199
4.210
4.221
4.231
4.241
4.251
4.262
4.272
4.283
4.293
4.303
4.313
4.325
4.335
4.345
4.356
4.367
4.378
4.389
4.399
4.409
4.420
4.430
4.441
4.451
4.461
4.472
4.482
4.492
4.503
4.513
4.524
4.534
4.545
4.555
4.565
4.576
4.586
4.596
4.607
4.617
4.627
4.638
4.648
4.659
4.669
4.679
4.690
4.700
4.710
4.721
4.731
4.746
4.756
4.767
4.778
4.788
4.799
4.809
4.820
4.830
4.841
4.852
4.862
4.872
4.883
4.893
4.903
4.913
4.924
4.934
4.944
4.954
4.965
4.975
4.985
4.995
5.5
time is up
java.lang.InterruptedException: sleep interrupted
    at java.lang.Thread.sleep(Native Method)
    at test.Test$TimeTask.run(Test.java:38)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
    at java.lang.Thread.run(Thread.java:745)
java.lang.InterruptedException: sleep interrupted
    at java.lang.Thread.sleep(Native Method)
    at test.Test$Spend.run(Test.java:70)
    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)
    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)
    at java.lang.Thread.run(Thread.java:745)

</p>
<p>Edit By <a href="http://mahua.jser.me">MaHua</a></p>
</body></html>