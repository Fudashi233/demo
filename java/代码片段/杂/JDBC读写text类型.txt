package cn.edu.jxau.test;

import java.io.File;
import java.io.FileInputStream;
import java.io.FileNotFoundException;
import java.io.FileReader;
import java.io.FileWriter;
import java.io.IOException;
import java.io.InputStream;
import java.io.InputStreamReader;
import java.io.Reader;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.Statement;
import java.sql.ResultSet;
import java.sql.SQLException;

import cn.edu.jxau.util.JDBCUtil;

class Test
{
	public static void main(String[] args) throws IOException
	{
		select();
	}
	public static void add()
	{
		Connection c = null;
		PreparedStatement p = null;
		Reader reader = null;
		try
		{
			String sql = "INSERT INTO data(t) VALUES(?)";
			c = JDBCUtil.getConnection();
			p = c.prepareStatement(sql);
			String path = Test.class.getResource("/cn/edu/jxau/resource/t.txt").getPath();
			File file = new File(path);
			reader = new FileReader(file);
			p.setCharacterStream(1,reader,file.length());
			p.executeUpdate();
		}
		catch(SQLException ex)
		{
			ex.printStackTrace();
		}
		catch(IOException ex)
		{
			ex.printStackTrace();
		}
		finally
		{
			try
			{
				if(reader!=null)
					reader.close();
			}
			catch(IOException ex)
			{
				ex.printStackTrace();
			}
			JDBCUtil.close(c,p,null);
		}
	}
	public static void select()
	{
		Connection c = null;
		PreparedStatement p = null;
		ResultSet r = null;
		FileWriter writer = null;
		try
		{
			String sql = "SELECT t FROM data";
			c = JDBCUtil.getConnection();
			p = c.prepareStatement(sql);
			r = p.executeQuery();
			writer = new FileWriter("D://temp.txt");
			while(r.next())
			{
				String content = r.getString(1);
				Reader reader = r.getCharacterStream(1);
				char[] buffer = new char[1024];
				
				int len = 0;
				while( (len = reader.read(buffer))>0 )
				{
					writer.write(buffer,0,len);
				}
				
			}

		}
		catch(SQLException ex)
		{
			ex.printStackTrace();
		}
		catch(IOException ex)
		{
			ex.printStackTrace();
		}
		finally
		{
			try
			{
				if(writer!=null)
				{
					writer.close();
				}
			}
			catch(IOException ex)
			{
				ex.printStackTrace();
			}		
			JDBCUtil.close(c,p,r);
		}
	}
}